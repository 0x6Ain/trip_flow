// MVP Trip Planner - Database Schema
// Generated from spec.md v0.1

Table trips {
  id integer [pk, increment, note: 'Auto increment primary key']
  owner_type varchar(10) [not null, note: 'GUEST | USER']
  owner_id varchar(255) [null, note: 'USER인 경우 user id']
  title varchar(255) [not null]
  city varchar(255) [not null]
  
  // Start Location (embedded)
  start_lat decimal(10, 8) [not null]
  start_lng decimal(11, 8) [not null]
  
  // Route Summary (embedded)
  total_duration_min integer [null, note: '총 소요 시간 (분)']
  total_distance_km decimal(10, 2) [null, note: '총 거리 (km)']
  
  created timestamp [not null, default: `now()`, note: 'TimeStampedModel']
  modified timestamp [not null, default: `now()`, note: 'TimeStampedModel']
  expires_at timestamp [null, note: 'GUEST only - 7~14일 후']
  
  indexes {
    owner_id
    created
    expires_at
  }
}

Table places {
  id integer [pk, increment, note: 'Auto increment primary key']
  trip_id integer [not null]
  place_id varchar(255) [not null, note: 'Google Places ID']
  name varchar(255) [not null]
  lat decimal(10, 8) [not null]
  lng decimal(11, 8) [not null]
  order decimal(10, 2) [not null, note: 'float for drag & drop']
  
  created timestamp [not null, default: `now()`, note: 'TimeStampedModel']
  modified timestamp [not null, default: `now()`, note: 'TimeStampedModel']
  
  indexes {
    trip_id
    (trip_id, order)
    place_id
  }
  
  Note: '최대 10개 제약은 애플리케이션 레벨에서 처리'
}

Table route_cache {
  id integer [pk, increment, note: 'Auto increment primary key']
  from_place_id varchar(255) [not null, note: 'Google Places ID']
  to_place_id varchar(255) [not null, note: 'Google Places ID']
  duration_min integer [not null, note: '소요 시간 (분)']
  distance_km decimal(10, 2) [not null, note: '거리 (km)']
  
  created timestamp [not null, default: `now()`, note: 'TimeStampedModel']
  modified timestamp [not null, default: `now()`, note: 'TimeStampedModel']
  expires_at timestamp [not null, note: '캐시 만료 시간']
  
  indexes {
    (from_place_id, to_place_id) [unique]
    expires_at
  }
  
  Note: 'Directions API 호출 최소화를 위한 캐싱'
}

Table users {
  id integer [pk, increment, note: 'Auto increment primary key']
  email varchar(255) [unique, not null]
  name varchar(255)
  
  created timestamp [not null, default: `now()`, note: 'TimeStampedModel']
  modified timestamp [not null, default: `now()`, note: 'TimeStampedModel']
  
  Note: 'v0.2에서 확장 예정 (MVP에서는 선택적)'
}

// Relationships
Ref: places.trip_id > trips.id [delete: cascade]

// Enums (참고용)
// UserType: GUEST, USER

// Business Rules (애플리케이션 레벨)
// 1. places per trip: max 10
// 2. Guest trips: auto-expire after 7-14 days
// 3. order: float type for flexible reordering
// 4. Duplicate place prevention: check by place_id per trip
